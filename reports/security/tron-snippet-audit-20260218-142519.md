# TRON Snippet Audit Report

- Generated: 2026-02-18T22:25:19Z
- Project root: `/Users/anonymous/perpx-local-integration`
- tron-connect test path: `/Users/anonymous/perpx-local-integration/client/public/tron-connect-test`
- app path: `/Users/anonymous/perpx-local-integration/client/src`

This report checks whether indicators from snippet files 03 to 07 appear in the local integration.

## 03 - tron_signTransaction methods

- Pattern: `tron_signTransaction|tron_signMessage`
- tron-connect-test: **DETECTED**
- client/src: **DETECTED**
- Note: WalletConnect(TRON) signature methods are expected in normal TRON connection flows.


### Matches in tron-connect-test
```text
/Users/anonymous/perpx-local-integration/client/public/tron-connect-test/walletconnect.js:1:import{WalletConnectWallet as y,WalletConnectClient as O}from"https://esm.sh/@tronweb3/walletconnect-tron@4.0.1?bundle";import{DEFAULT_TRON_CHAIN as m,TRON_MAINNET as I,TRON_SHASTA as W,TRON_NILE as E,WALLETCONNECT_PROJECT_ID as h}from"./constants/tron.js";let c=null,s=m,a=null,w=null,d=null,f="adapter";function _(){if(!h||h==="YOUR_REAL_PROJECT_ID")throw new Error("WalletConnect projectId is missing. Set it in public/constants/tron.js")}function T(e){return[I,W,E].includes(e)?e:m}function o(e,n,t,r){if(e)try{e(n,t,r||{})}catch(l){console.error("log handler error:",l)}}function C(e){return typeof e=="string"&&e.startsWith("T")&&e.length>=34}function g(){const e=navigator.userAgent||navigator.vendor||window.opera;return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e.toLowerCase())}function R(e,n,t=!1){const r=T(e);if(c&&s===r&&!t)return c;if(t&&c){try{c.disconnect().catch(i=>{console.error("Error disconnecting old wallet:",i)})}catch(i){console.error("Sync error disconnecting old wallet:",i)}c=null}_(),s=r;const l=g();return c=new y({network:s,options:{projectId:h,metadata:{name:"TRON Connect Test",description:"WalletConnect v2 (TRON adapter)",url:window.location.origin,icons:[]}},allWallets:l?"ALL":"SHOW",debug:!1}),o(n,"info","wc.wallet_created",{chainId:s,isMobile:l,forceNew:t}),c}async function M(e){return w||(_(),w=await O.init({projectId:h,metadata:{name:"TRON Connect Test",description:"WalletConnect v2 (TRON adapter fallback)",url:window.location.origin,icons:[]}}),o(e,"info","wc.sign_client_ready"),w)}function v(e){const n=Object.values(e?.namespaces||{}).flatMap(t=>t.accounts||[])[0];return n&&n.split(":")[2]||null}function b(e){const n=e?.message||"";return n.includes("reading 'chains'")||n.includes("chains")}async function N(e,n,t={}){const r=await M(n);f="signclient",s=T(e);const l=g();if(o(n,"info","wc.fallback.start",{chainId:s,isMobile:l}),t.forceNew&&d)try{await r.disconnect({topic:d.topic,reason:{code:6e3,message:"Force new session"}})}catch(p){console.error("wc force disconnect error:",p)}finally{d=null}const{uri:i,approval:u}=await r.connect({requiredNamespaces:{tron:{chains:[s],methods:["tron_signTransaction","tron_signMessage"],events:[]}}});if(i&&o(n,"info","wc.qr",{uri:i}),d=await u(),a=v(d),!C(a))throw o(n,"error","wc.connect.invalid_address",{address:a}),new Error("WalletConnect connected to a non-TRON wallet. Use a TRON-compatible wallet.");return o(n,"info","wc.connect.success",{address:a,chainId:s}),{address:a,chainId:s}}async function S(e,n,t={}){const r=g();if(t.forceSignClient||r&&!t.skipMobileFallback)return o(n,"info","wc.mobile_detected",{isMobile:r,forceSignClient:t.forceSignClient}),await N(e,n,t);const l=R(e,n,t.forceNew);o(n,"info","wc.connect.start",{chainId:s,isMobile:r});try{const i=await l.connect();if(f="adapter",d=null,a=i.address,!C(a)){o(n,"error","wc.connect.invalid_address",{address:a});try{await l.disconnect()}catch(u){console.error("wc disconnect after invalid address failed:",u)}throw new Error("WalletConnect connected to a non-TRON wallet. Use a TRON-compatible wallet.")}return o(n,"info","wc.connect.success",{address:a,chainId:s}),{address:a,chainId:s}}catch(i){const u=i?.message||String(i),p=g();if(o(n,"error","wc.adapter_error",{message:u,isMobile:p}),b(i)||p&&u.includes("User rejected"))return o(n,"info","wc.fallback_trigger",{reason:b(i)?"chains_error":"mobile_rejection"}),await N(e,n,t);throw i}}async function q(e){if(!(!c&&!w))try{if(f==="signclient"&&w&&d)try{await w.disconnect({topic:d.topic,reason:{code:6e3,message:"User disconnected"}})}catch(n){console.error("wc sign-client disconnect error:",n)}else c&&await c.disconnect()}finally{c=null,w=null,d=null,a=null,s=m,f="adapter",o(e,"info","wc.disconnect")}}async function A(e,n){if(f==="signclient"){if(!w||!d)throw new Error("WalletConnect not initialized");o(n,"info","wc.sign.request",{method:"tron_signMessage"});const r=await w.request({chainId:s,topic:d.topic,request:{method:"tron_signMessage",params:{address:a,message:e}}}),l=r?.signature||r;return o(n,"info","wc.sign.response",{signature:l}),l}if(!c)throw new Error("WalletConnect not initialized");o(n,"info","wc.sign.request",{method:"tron_signMessage"});const t=await c.signMessage(e);return o(n,"info","wc.sign.response",{signature:t}),t}async function j(e,n){if(f==="signclient"){if(!w||!d)throw new Error("WalletConnect not initialized");o(n,"info","wc.tx.request",{method:"tron_signTransaction"});const l=d?.sessionProperties?.tron_method_version==="v1"?{address:a,transaction:e}:{address:a,transaction:{transaction:e}},i=await w.request({chainId:s,topic:d.topic,request:{method:"tron_signTransaction",params:l}}),u=i?.result||i;return o(n,"info","wc.tx.response"),u}if(!c)throw new Error("WalletConnect not initialized");o(n,"info","wc.tx.request",{method:"tron_signTransaction"});const t=await c.signTransaction(e),r=t?.result||t;return o(n,"info","wc.tx.response"),r}function k(){return a}export{k as getWcAddress,g as isMobileDevice,S as wcConnectTron,q as wcDisconnect,A as wcSignMessage,j as wcSignTransaction};
/Users/anonymous/perpx-local-integration/client/public/tron-connect-test/index.html:107:      </html>`;T.document.open(),T.document.write(o),T.document.close(),I&&clearTimeout(I),I=setTimeout(()=>L(),12e4)}function L(){T&&!T.closed&&T.close(),T=null,F="",H=!1,j=null,I&&clearTimeout(I)}function r(e,t,n={}){const o={ts:new Date().toISOString(),level:e,event:t,...n};fe.textContent+=JSON.stringify(o)+"\\n",t==="wc.qr"&&n?.uri&&Ce(n.uri).catch(a=>{console.error("QR render error:",a)}),t==="connect.success"&&L()}function K(){we.textContent=c.providerType||"-",ge.textContent=c.address||"-",ee.textContent="Status: -"}function We(e){const t=e==="evm";if(pe.classList.toggle("hidden",t),he.classList.toggle("hidden",!t),k)if(t){const n=k.dataset.src;n&&k.getAttribute("src")!==n&&k.setAttribute("src",n)}else k.getAttribute("src")&&k.getAttribute("src")!=="about:blank"&&k.setAttribute("src","about:blank");te.forEach(n=>{n.classList.toggle("active",n.dataset.mode===e)})}te.forEach(e=>{e.addEventListener("click",()=>We(e.dataset.mode))}),document.addEventListener("keydown",e=>{e.key==="Escape"&&L()}),L();function W(e,t,n){return Promise.race([e,new Promise((o,a)=>{setTimeout(()=>{a(new Error(n||"request_timeout"))},t)})])}function Se(){const e=me.value||"mainnet";return _e[e]||P}function y(e){ee.textContent=`Status: ${e}`}function A(e){return typeof e=="string"&&e.startsWith("T")&&e.length>=34}function Ie(e){return e===Y?"https://nile.tronscan.org/#/transaction/":e===X?"https://shasta.tronscan.org/#/transaction/":"https://tronscan.org/#/transaction/"}function M(e,t){return t?`${Ie(e)}${t}`:null}function B(e){const t=e?.txid||e?.transaction?.txID||e?.transaction?.txid||e?.txID||(typeof e=="string"?e:null),n=typeof e?.result=="boolean"?e.result:void 0,o=e?.code?String(e.code):void 0,a=typeof e?.message=="string"?e.message:e?.message?JSON.stringify(e.message):void 0;return{txid:t,ok:n,code:o,message:a,raw:e}}function $(e){if(typeof e!="string")return e;const t=e.startsWith("0x")?e.slice(2):e;if(!/^[0-9a-fA-F]+$/.test(t)||t.length%2!==0)return e;let n="";for(let o=0;o<t.length;o+=2){const a=parseInt(t.slice(o,o+2),16);if(Number.isNaN(a))return e;n+=String.fromCharCode(a)}return n}function N(e){return!!(!e||e.ok===!1||e.code)}async function U(e,t,n){if(!e||!t)return!1;const o=M(c.chainId,t),a=6;for(let i=0;i<a;i+=1){try{const d=await e.trx.getTransaction(t);if(d&&(d.txID||d.txid))return r("info",`${n}.chain_seen`,{txid:t,explorerUrl:o}),!0}catch{}await new Promise(d=>setTimeout(d,2e3))}return r("error",`${n}.chain_not_found`,{txid:t,explorerUrl:o,hint:"Transaction not found yet. Check network selection or wait and retry."}),!1}function Le(){c.providerType=null,c.address=null,K()}async function oe(e="auto"){c.chainId=Se();const t=D();r("info","connect.start",{chainId:c.chainId,mode:e,isMobile:t}),Le(),H=e==="walletconnect",j=e,e!=="walletconnect"&&L(),t&&e==="walletconnect"&&v&&(v.textContent="WalletConnect\u3092\u6E96\u5099\u3057\u3066\u3044\u307E\u3059...",v.style.color="#666");const n=!!(window.tronLink||window.tronWeb);let o=!1,a=null;if(e!=="walletconnect"&&n){o=!0;try{if(!window.tronLink?.request)throw new Error("TronLink request API not available");const i=window.tronWeb?.defaultAddress?.base58||null;let d=null;try{d=await window.tronLink.request({method:"tron_requestAccounts"})}catch(w){const f=w?.message||String(w);throw w?.code===4001||/reject|denied|cancel/i.test(f)?(r("info","connect.cancelled",{providerType:"tronlink_extension"}),new Error("User cancelled TronLink connection")):w}let u=Array.isArray(d)&&d[0]||d?.address||d?.base58||null;if(!A(u)){r("info","connect.tronlink_waiting");let w=0;for(;w<10;){await new Promise(l=>setTimeout(l,200));const f=window.tronWeb?.defaultAddress?.base58||null;if(A(f)){u=f;break}w+=1}}if(!A(u)||i&&u===null)throw r("error","connect.tronlink_invalid_address",{address:u}),new Error("TronLink did not return a valid TRON address");c.providerType="tronlink_extension",c.address=u,r("info","connect.success",{providerType:c.providerType,address:c.address,chainId:c.chainId}),K();return}catch(i){a=i,r("error","connect.tronlink_error",{message:i?.message||String(i)})}}if(e!=="walletconnect")throw o?a||new Error("TronLink connection failed"):(r("error","connect.tronlink_missing",{message:"TronLink not found. Use Connect (WalletConnect) instead."}),new Error("TronLink not found. Use Connect (WalletConnect) instead."));try{const i=await le(c.chainId,r,{forceSignClient:e==="walletconnect"||t,forceNew:e==="walletconnect",skipMobileFallback:!1});c.providerType="walletconnect_v2_tron",c.address=i.address,r("info","connect.success",{providerType:c.providerType,address:c.address,chainId:c.chainId,isMobile:t}),K()}catch(i){const d=i?.message||String(i);throw r("error","connect.walletconnect_error",{message:d,hint:t?"\u30E2\u30D0\u30A4\u30EB\u30A6\u30A9\u30EC\u30C3\u30C8\u30A2\u30D7\u30EA\uFF08Trust Wallet\u3001SafePal\u7B49\uFF09\u3092\u4F7F\u7528\u3057\u3066\u304F\u3060\u3055\u3044":"TronLink \u62E1\u5F35\u307E\u305F\u306F TronLink Pro \u3092\u5C0E\u5165\u3057\u3066\u304F\u3060\u3055\u3044",isMobile:t}),t&&v&&(v.textContent="WalletConnect\u63A5\u7D9A\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u30ED\u30B0\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002",v.style.color="#b00020"),i}}async function Ae(){if(!c.address||!c.providerType)throw new Error("Not connected");const e="hello";if(r("info","sign.request",{providerType:c.providerType,message:e}),y("Waiting for signature approval..."),c.providerType==="tronlink_extension")try{const n=await W(window.tronLink.request({method:"tron_signMessageV2",params:{message:e}}),6e4,"TronLink request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002");r("info","sign.response",{signature:n,method:"tron_signMessageV2"}),y("Signature approved");return}catch(n){const o=n?.message||String(n);if(r("error","sign.v2_error",{message:o}),!/Unknown method/i.test(o))throw n;try{const a=await W(window.tronLink.request({method:"tron_signMessage",params:{message:e,address:c.address}}),6e4,"TronLink request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002");r("info","sign.response",{signature:a,method:"tron_signMessage"}),y("Signature approved");return}catch(a){const i=a?.message||String(a);if(r("error","sign.v1_error",{message:i}),/Unknown method/i.test(i)){const d=window.tronWeb,u=d?.trx?.signMessageV2||d?.trx?.signMessage||null;if(typeof u=="function"){const w=await W(u.call(d.trx,e),6e4,"TronWeb sign message timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002");r("info","sign.response",{signature:w,method:"tronweb.signMessage"}),y("Signature approved");return}}throw a}}const t=await W(ue(e,r),6e4,"WalletConnect request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002");r("info","sign.response",{signature:t}),y("Signature approved")}async function Me(){if(!c.address||!c.providerType)throw new Error("Not connected");const t=(window.prompt("TRC20 token contract address","")||"").trim();if(t===null){r("info","approve.cancelled_by_user");return}if(!t)throw new Error("Token address is required");if(!A(t))throw new Error("Invalid TRC20 contract address format");const o=(window.prompt("Spender address","")||"").trim();if(!o)throw new Error("Spender address is required");if(!A(o))throw new Error("Invalid spender address format");const i=(window.prompt("Amount (uint256)","1000000")||"").trim();if(!i)throw new Error("Amount is required");if(!window.confirm("This will send a real TRC20 approve transaction. Continue?")){r("info","approve.cancelled");return}if(r("info","approve.request",{token:t,spender:o,amount:i}),y("Waiting for approve confirmation..."),c.providerType==="tronlink_extension"){const h=window.tronWeb;if(!h)throw new Error("TronWeb not available");const p=await h.trx.getContract(t);if(!p||Object.keys(p).length===0||!p.abi)throw new Error("Contract not found on selected network");const S=await h.transactionBuilder.triggerSmartContract(t,"approve(address,uint256)",{feeLimit:1e8,callValue:0},[{type:"address",value:o},{type:"uint256",value:i}],c.address),R=await h.trx.sign(S.transaction),se=await h.trx.sendRawTransaction(R),x=B(se),O=$(x.message);r("info","approve.broadcast_result",{txid:x.txid,ok:x.ok,code:x.code,message:O});const z=M(c.chainId,x.txid);if(N(x)||!x.txid)throw r("error","approve.broadcast_failed",{txid:x.txid,explorerUrl:z,code:x.code,message:O}),new Error(O||"Approve broadcast failed");r("info","approve.sent",{txid:x.txid,explorerUrl:z}),await U(h,x.txid,"approve"),y("Approve sent");return}const u=window.prompt("Full node URL","https://api.trongrid.io");if(!u)throw new Error("Full node URL is required");const w=re();if(!w)throw new Error("TronWeb not available");const f=new w({fullHost:u}),l=await f.trx.getContract(t);if(!l||Object.keys(l).length===0||!l.abi)throw new Error("Contract not found on selected network");const E=await f.transactionBuilder.triggerSmartContract(t,"approve(address,uint256)",{feeLimit:1e8,callValue:0},[{type:"address",value:o},{type:"uint256",value:i}],c.address),C=await W(Z(E.transaction,r),6e4,"WalletConnect request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),g=await f.trx.sendRawTransaction(C),s=B(g),m=$(s.message);r("info","approve.broadcast_result",{txid:s.txid,ok:s.ok,code:s.code,message:m,fullHost:u});const b=M(c.chainId,s.txid);if(N(s)||!s.txid)throw r("error","approve.broadcast_failed",{txid:s.txid,explorerUrl:b,code:s.code,message:m}),new Error(m||"Approve broadcast failed");r("info","approve.sent",{txid:s.txid,explorerUrl:b}),await U(f,s.txid,"approve"),y("Approve sent")}async function Re(){if(!c.address||!c.providerType)throw new Error("Not connected");const e=window.prompt("To address","");if(e===null){r("info","tx.cancelled_by_user");return}if(!e)throw new Error("To address is required");const t=window.prompt("Amount (TRX)","0.1");if(!t)throw new Error("Amount is required");if(!window.confirm("This will send a real transaction on the selected network. Continue?")){r("info","tx.cancelled");return}if(r("info","tx.build",{toAddress:e,amountTrx:t,chainId:c.chainId}),y("Waiting for transaction approval..."),c.providerType==="tronlink_extension"){const g=window.tronWeb;if(!g)throw new Error("TronWeb not available");const s=g.toSun?g.toSun(t):Math.floor(Number(t)*1e6),m=await g.transactionBuilder.sendTrx(e,s,c.address),b=await g.trx.sign(m),h=await g.trx.sendRawTransaction(b),p=B(h),S=$(p.message);r("info","tx.broadcast_result",{txid:p.txid,ok:p.ok,code:p.code,message:S});const R=M(c.chainId,p.txid);if(N(p)||!p.txid)throw r("error","tx.broadcast_failed",{txid:p.txid,explorerUrl:R,code:p.code,message:S}),new Error(S||"Transaction broadcast failed");r("info","tx.sent",{txid:p.txid,explorerUrl:R}),await U(g,p.txid,"tx"),y("Transaction sent");return}const o=window.prompt("Full node URL","https://api.trongrid.io");if(!o)throw new Error("Full node URL is required");const a=re();if(!a)throw new Error("TronWeb not available");const i=new a({fullHost:o}),d=i.toSun?i.toSun(t):Math.floor(Number(t)*1e6),u=await i.transactionBuilder.sendTrx(e,d,c.address),w=await W(Z(u,r),6e4,"WalletConnect request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),f=await i.trx.sendRawTransaction(w),l=B(f),E=$(l.message);r("info","tx.broadcast_result",{txid:l.txid,ok:l.ok,code:l.code,message:E,fullHost:o});const C=M(c.chainId,l.txid);if(N(l)||!l.txid)throw r("error","tx.broadcast_failed",{txid:l.txid,explorerUrl:C,code:l.code,message:E}),new Error(E||"Transaction broadcast failed");r("info","tx.sent",{txid:l.txid,explorerUrl:C}),await U(i,l.txid,"tx"),y("Transaction sent")}document.getElementById("btnConnectTron").onclick=async()=>{try{await oe("auto")}catch(e){console.error(e),r("error","connect.error",{message:e?.message||String(e)})}},document.getElementById("btnConnectWc").onclick=async()=>{try{await oe("walletconnect")}catch(e){console.error(e),r("error","connect.error",{message:e?.message||String(e)})}},document.getElementById("btnSignMessage").onclick=async()=>{try{await Ae()}catch(e){console.error(e),r("error","sign.error",{message:e?.message||String(e)}),y("Sign failed")}},document.getElementById("btnApproveTrc20").onclick=async()=>{try{await Me()}catch(e){console.error(e),r("error","approve.error",{message:e?.message||String(e)}),y("Approve failed")}},document.getElementById("btnSendTx").onclick=async()=>{try{await Re()}catch(e){console.error(e),r("error","tx.error",{message:e?.message||String(e)}),y("Transaction failed")}};function ie(){D()&&(v.textContent="\u30E2\u30D0\u30A4\u30EB\u30C7\u30D0\u30A4\u30B9\u304C\u691C\u51FA\u3055\u308C\u307E\u3057\u305F\u3002WalletConnect\u63A5\u7D9A\u306F\u30A6\u30A9\u30EC\u30C3\u30C8\u9078\u629E\u65B9\u5F0F\u306B\u306A\u308A\u307E\u3059\u3002",v.style.color="#0066cc")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ie):ie();
```

### Matches in client/src
```text
/Users/anonymous/perpx-local-integration/client/src/hooks/useTronWallet.ts:156:              'tron_signMessage',
/Users/anonymous/perpx-local-integration/client/src/hooks/useTronWallet.ts:157:              'tron_signTransaction',
/Users/anonymous/perpx-local-integration/client/src/hooks/useTronWallet.ts:305:          method: 'tron_signMessage',
```

## 04 - WalletConnect session flow indicators

- Pattern: `requiredNamespaces|session_delete|approval\(|wcConnectTron|walletconnect`
- tron-connect-test: **DETECTED**
- client/src: **DETECTED**
- Note: Presence indicates WalletConnect flow wiring, not automatically malicious.


### Matches in tron-connect-test
```text
/Users/anonymous/perpx-local-integration/client/public/tron-connect-test/walletconnect.js:1:import{WalletConnectWallet as y,WalletConnectClient as O}from"https://esm.sh/@tronweb3/walletconnect-tron@4.0.1?bundle";import{DEFAULT_TRON_CHAIN as m,TRON_MAINNET as I,TRON_SHASTA as W,TRON_NILE as E,WALLETCONNECT_PROJECT_ID as h}from"./constants/tron.js";let c=null,s=m,a=null,w=null,d=null,f="adapter";function _(){if(!h||h==="YOUR_REAL_PROJECT_ID")throw new Error("WalletConnect projectId is missing. Set it in public/constants/tron.js")}function T(e){return[I,W,E].includes(e)?e:m}function o(e,n,t,r){if(e)try{e(n,t,r||{})}catch(l){console.error("log handler error:",l)}}function C(e){return typeof e=="string"&&e.startsWith("T")&&e.length>=34}function g(){const e=navigator.userAgent||navigator.vendor||window.opera;return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e.toLowerCase())}function R(e,n,t=!1){const r=T(e);if(c&&s===r&&!t)return c;if(t&&c){try{c.disconnect().catch(i=>{console.error("Error disconnecting old wallet:",i)})}catch(i){console.error("Sync error disconnecting old wallet:",i)}c=null}_(),s=r;const l=g();return c=new y({network:s,options:{projectId:h,metadata:{name:"TRON Connect Test",description:"WalletConnect v2 (TRON adapter)",url:window.location.origin,icons:[]}},allWallets:l?"ALL":"SHOW",debug:!1}),o(n,"info","wc.wallet_created",{chainId:s,isMobile:l,forceNew:t}),c}async function M(e){return w||(_(),w=await O.init({projectId:h,metadata:{name:"TRON Connect Test",description:"WalletConnect v2 (TRON adapter fallback)",url:window.location.origin,icons:[]}}),o(e,"info","wc.sign_client_ready"),w)}function v(e){const n=Object.values(e?.namespaces||{}).flatMap(t=>t.accounts||[])[0];return n&&n.split(":")[2]||null}function b(e){const n=e?.message||"";return n.includes("reading 'chains'")||n.includes("chains")}async function N(e,n,t={}){const r=await M(n);f="signclient",s=T(e);const l=g();if(o(n,"info","wc.fallback.start",{chainId:s,isMobile:l}),t.forceNew&&d)try{await r.disconnect({topic:d.topic,reason:{code:6e3,message:"Force new session"}})}catch(p){console.error("wc force disconnect error:",p)}finally{d=null}const{uri:i,approval:u}=await r.connect({requiredNamespaces:{tron:{chains:[s],methods:["tron_signTransaction","tron_signMessage"],events:[]}}});if(i&&o(n,"info","wc.qr",{uri:i}),d=await u(),a=v(d),!C(a))throw o(n,"error","wc.connect.invalid_address",{address:a}),new Error("WalletConnect connected to a non-TRON wallet. Use a TRON-compatible wallet.");return o(n,"info","wc.connect.success",{address:a,chainId:s}),{address:a,chainId:s}}async function S(e,n,t={}){const r=g();if(t.forceSignClient||r&&!t.skipMobileFallback)return o(n,"info","wc.mobile_detected",{isMobile:r,forceSignClient:t.forceSignClient}),await N(e,n,t);const l=R(e,n,t.forceNew);o(n,"info","wc.connect.start",{chainId:s,isMobile:r});try{const i=await l.connect();if(f="adapter",d=null,a=i.address,!C(a)){o(n,"error","wc.connect.invalid_address",{address:a});try{await l.disconnect()}catch(u){console.error("wc disconnect after invalid address failed:",u)}throw new Error("WalletConnect connected to a non-TRON wallet. Use a TRON-compatible wallet.")}return o(n,"info","wc.connect.success",{address:a,chainId:s}),{address:a,chainId:s}}catch(i){const u=i?.message||String(i),p=g();if(o(n,"error","wc.adapter_error",{message:u,isMobile:p}),b(i)||p&&u.includes("User rejected"))return o(n,"info","wc.fallback_trigger",{reason:b(i)?"chains_error":"mobile_rejection"}),await N(e,n,t);throw i}}async function q(e){if(!(!c&&!w))try{if(f==="signclient"&&w&&d)try{await w.disconnect({topic:d.topic,reason:{code:6e3,message:"User disconnected"}})}catch(n){console.error("wc sign-client disconnect error:",n)}else c&&await c.disconnect()}finally{c=null,w=null,d=null,a=null,s=m,f="adapter",o(e,"info","wc.disconnect")}}async function A(e,n){if(f==="signclient"){if(!w||!d)throw new Error("WalletConnect not initialized");o(n,"info","wc.sign.request",{method:"tron_signMessage"});const r=await w.request({chainId:s,topic:d.topic,request:{method:"tron_signMessage",params:{address:a,message:e}}}),l=r?.signature||r;return o(n,"info","wc.sign.response",{signature:l}),l}if(!c)throw new Error("WalletConnect not initialized");o(n,"info","wc.sign.request",{method:"tron_signMessage"});const t=await c.signMessage(e);return o(n,"info","wc.sign.response",{signature:t}),t}async function j(e,n){if(f==="signclient"){if(!w||!d)throw new Error("WalletConnect not initialized");o(n,"info","wc.tx.request",{method:"tron_signTransaction"});const l=d?.sessionProperties?.tron_method_version==="v1"?{address:a,transaction:e}:{address:a,transaction:{transaction:e}},i=await w.request({chainId:s,topic:d.topic,request:{method:"tron_signTransaction",params:l}}),u=i?.result||i;return o(n,"info","wc.tx.response"),u}if(!c)throw new Error("WalletConnect not initialized");o(n,"info","wc.tx.request",{method:"tron_signTransaction"});const t=await c.signTransaction(e),r=t?.result||t;return o(n,"info","wc.tx.response"),r}function k(){return a}export{k as getWcAddress,g as isMobileDevice,S as wcConnectTron,q as wcDisconnect,A as wcSignMessage,j as wcSignTransaction};
/Users/anonymous/perpx-local-integration/client/public/tron-connect-test/index.html:79:<script type="module">import{TRON_MAINNET as P,TRON_SHASTA as X,TRON_NILE as Y,WALLETCONNECT_PROJECT_ID as Q,WALLETCONNECT_API_BASE as ae,WALLETCONNECT_SDK_TYPE as ce,WALLETCONNECT_SDK_VERSION as de,WALLETCONNECT_MOBILE_WALLETS as G}from"./constants/tron.js";import{wcConnectTron as le,wcSignMessage as ue,wcSignTransaction as Z,isMobileDevice as D}from"./walletconnect.js";import*as _ from"https://esm.sh/tronweb@6.1.1?bundle";const fe=document.getElementById("log"),we=document.getElementById("providerType"),ge=document.getElementById("address"),me=document.getElementById("selectChain"),ee=document.getElementById("pendingStatus"),v=document.getElementById("mobileStatus"),pe=document.getElementById("tronMode"),he=document.getElementById("evmMode"),k=document.getElementById("evmFrame"),te=document.querySelectorAll(".mode-btn");let H=!1,q=null,F="",I=null,T=null,j=null;async function ne(){if(q)return q;try{const e=await import("https://esm.sh/qrcode@1.5.3?bundle");return q=e?.default||e,q}catch(e){return r("error","wc.qr_lib_error",{message:e?.message||String(e)}),null}}const V=new Map,J=new Map;function ye(){if(!Q||Q==="YOUR_REAL_PROJECT_ID")throw new Error("WalletConnect projectId is missing. Set it in public/constants/tron.js")}function be(e,t){if(!Array.isArray(e)||e.length===0)return null;const n=(t?.search||t?.name||"").toLowerCase();if(n){const o=e.find(i=>(i?.name||"").toLowerCase()===n);if(o)return o;const a=e.find(i=>(i?.name||"").toLowerCase().includes(n));if(a)return a}return e[0]||null}function xe(e,t){if(!e||!t)return null;const n=encodeURIComponent(t);return e.includes("{uri}")?e.replace("{uri}",n):e.includes("wc?uri=")?`${e}${n}`:e.includes("wc?uri")&&!e.includes("uri=")?`${e}=${n}`:e.includes("uri=")?`${e}${n}`:/^.+:\/\/$/.test(e)?`${e}wc?uri=${n}`:/wc\/?$/.test(e)?`${e}?uri=${n}`:e.endsWith("/")?`${e}wc?uri=${n}`:`${e}/wc?uri=${n}`}async function Te(e,t){const n=`${e||""}|${t||""}`;if(V.has(n))return V.get(n);ye();const o=new URL(`${ae}/getWallets`);o.searchParams.set("page","1"),o.searchParams.set("entries","6"),e&&o.searchParams.set("search",e),t&&o.searchParams.set("platform",t);const a=await fetch(o.toString(),{headers:{"x-project-id":Q,"x-sdk-type":ce,"x-sdk-version":de}});if(!a.ok)throw new Error(`wc_wallets_fetch_failed_${a.status}`);const i=await a.json(),d=Array.isArray(i?.data)?i.data:[];return V.set(n,d),d}async function ve(e,t){const n=e?.universalLink||e?.deepLink;if(n)return n;const o=`${e?.id||e?.name||"wallet"}|${t||""}`;if(J.has(o))return J.get(o);const a=await Te(e?.search||e?.name||"",t),i=be(a,e),d=i?.mobile_link||i?.webapp_link||null;return d&&J.set(o,d),d}async function Ee(e,t,n){const o=await ve(e,n);return xe(o,t)}const c={providerType:null,address:null,chainId:P},_e={mainnet:P,shasta:X,nile:Y};function re(){return typeof _=="function"?_:typeof _?.TronWeb=="function"?_.TronWeb:typeof _?.default=="function"?_.default:typeof _?.default?.TronWeb=="function"?_.default.TronWeb:typeof window.TronWeb=="function"?window.TronWeb:null}function ke(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}async function Ce(e){if(!H||j!=="walletconnect"||!e)return;if(D()){const a=navigator.userAgent||navigator.vendor||window.opera||"",i=/iphone|ipad|ipod/i.test(a),d=e&&e.startsWith("wc:")?e:`wc:${e}`;if(F=e,v){v.innerHTML=`
/Users/anonymous/perpx-local-integration/client/public/tron-connect-test/index.html:107:      </html>`;T.document.open(),T.document.write(o),T.document.close(),I&&clearTimeout(I),I=setTimeout(()=>L(),12e4)}function L(){T&&!T.closed&&T.close(),T=null,F="",H=!1,j=null,I&&clearTimeout(I)}function r(e,t,n={}){const o={ts:new Date().toISOString(),level:e,event:t,...n};fe.textContent+=JSON.stringify(o)+"\\n",t==="wc.qr"&&n?.uri&&Ce(n.uri).catch(a=>{console.error("QR render error:",a)}),t==="connect.success"&&L()}function K(){we.textContent=c.providerType||"-",ge.textContent=c.address||"-",ee.textContent="Status: -"}function We(e){const t=e==="evm";if(pe.classList.toggle("hidden",t),he.classList.toggle("hidden",!t),k)if(t){const n=k.dataset.src;n&&k.getAttribute("src")!==n&&k.setAttribute("src",n)}else k.getAttribute("src")&&k.getAttribute("src")!=="about:blank"&&k.setAttribute("src","about:blank");te.forEach(n=>{n.classList.toggle("active",n.dataset.mode===e)})}te.forEach(e=>{e.addEventListener("click",()=>We(e.dataset.mode))}),document.addEventListener("keydown",e=>{e.key==="Escape"&&L()}),L();function W(e,t,n){return Promise.race([e,new Promise((o,a)=>{setTimeout(()=>{a(new Error(n||"request_timeout"))},t)})])}function Se(){const e=me.value||"mainnet";return _e[e]||P}function y(e){ee.textContent=`Status: ${e}`}function A(e){return typeof e=="string"&&e.startsWith("T")&&e.length>=34}function Ie(e){return e===Y?"https://nile.tronscan.org/#/transaction/":e===X?"https://shasta.tronscan.org/#/transaction/":"https://tronscan.org/#/transaction/"}function M(e,t){return t?`${Ie(e)}${t}`:null}function B(e){const t=e?.txid||e?.transaction?.txID||e?.transaction?.txid||e?.txID||(typeof e=="string"?e:null),n=typeof e?.result=="boolean"?e.result:void 0,o=e?.code?String(e.code):void 0,a=typeof e?.message=="string"?e.message:e?.message?JSON.stringify(e.message):void 0;return{txid:t,ok:n,code:o,message:a,raw:e}}function $(e){if(typeof e!="string")return e;const t=e.startsWith("0x")?e.slice(2):e;if(!/^[0-9a-fA-F]+$/.test(t)||t.length%2!==0)return e;let n="";for(let o=0;o<t.length;o+=2){const a=parseInt(t.slice(o,o+2),16);if(Number.isNaN(a))return e;n+=String.fromCharCode(a)}return n}function N(e){return!!(!e||e.ok===!1||e.code)}async function U(e,t,n){if(!e||!t)return!1;const o=M(c.chainId,t),a=6;for(let i=0;i<a;i+=1){try{const d=await e.trx.getTransaction(t);if(d&&(d.txID||d.txid))return r("info",`${n}.chain_seen`,{txid:t,explorerUrl:o}),!0}catch{}await new Promise(d=>setTimeout(d,2e3))}return r("error",`${n}.chain_not_found`,{txid:t,explorerUrl:o,hint:"Transaction not found yet. Check network selection or wait and retry."}),!1}function Le(){c.providerType=null,c.address=null,K()}async function oe(e="auto"){c.chainId=Se();const t=D();r("info","connect.start",{chainId:c.chainId,mode:e,isMobile:t}),Le(),H=e==="walletconnect",j=e,e!=="walletconnect"&&L(),t&&e==="walletconnect"&&v&&(v.textContent="WalletConnect\u3092\u6E96\u5099\u3057\u3066\u3044\u307E\u3059...",v.style.color="#666");const n=!!(window.tronLink||window.tronWeb);let o=!1,a=null;if(e!=="walletconnect"&&n){o=!0;try{if(!window.tronLink?.request)throw new Error("TronLink request API not available");const i=window.tronWeb?.defaultAddress?.base58||null;let d=null;try{d=await window.tronLink.request({method:"tron_requestAccounts"})}catch(w){const f=w?.message||String(w);throw w?.code===4001||/reject|denied|cancel/i.test(f)?(r("info","connect.cancelled",{providerType:"tronlink_extension"}),new Error("User cancelled TronLink connection")):w}let u=Array.isArray(d)&&d[0]||d?.address||d?.base58||null;if(!A(u)){r("info","connect.tronlink_waiting");let w=0;for(;w<10;){await new Promise(l=>setTimeout(l,200));const f=window.tronWeb?.defaultAddress?.base58||null;if(A(f)){u=f;break}w+=1}}if(!A(u)||i&&u===null)throw r("error","connect.tronlink_invalid_address",{address:u}),new Error("TronLink did not return a valid TRON address");c.providerType="tronlink_extension",c.address=u,r("info","connect.success",{providerType:c.providerType,address:c.address,chainId:c.chainId}),K();return}catch(i){a=i,r("error","connect.tronlink_error",{message:i?.message||String(i)})}}if(e!=="walletconnect")throw o?a||new Error("TronLink connection failed"):(r("error","connect.tronlink_missing",{message:"TronLink not found. Use Connect (WalletConnect) instead."}),new Error("TronLink not found. Use Connect (WalletConnect) instead."));try{const i=await le(c.chainId,r,{forceSignClient:e==="walletconnect"||t,forceNew:e==="walletconnect",skipMobileFallback:!1});c.providerType="walletconnect_v2_tron",c.address=i.address,r("info","connect.success",{providerType:c.providerType,address:c.address,chainId:c.chainId,isMobile:t}),K()}catch(i){const d=i?.message||String(i);throw r("error","connect.walletconnect_error",{message:d,hint:t?"\u30E2\u30D0\u30A4\u30EB\u30A6\u30A9\u30EC\u30C3\u30C8\u30A2\u30D7\u30EA\uFF08Trust Wallet\u3001SafePal\u7B49\uFF09\u3092\u4F7F\u7528\u3057\u3066\u304F\u3060\u3055\u3044":"TronLink \u62E1\u5F35\u307E\u305F\u306F TronLink Pro \u3092\u5C0E\u5165\u3057\u3066\u304F\u3060\u3055\u3044",isMobile:t}),t&&v&&(v.textContent="WalletConnect\u63A5\u7D9A\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u30ED\u30B0\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002",v.style.color="#b00020"),i}}async function Ae(){if(!c.address||!c.providerType)throw new Error("Not connected");const e="hello";if(r("info","sign.request",{providerType:c.providerType,message:e}),y("Waiting for signature approval..."),c.providerType==="tronlink_extension")try{const n=await W(window.tronLink.request({method:"tron_signMessageV2",params:{message:e}}),6e4,"TronLink request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002");r("info","sign.response",{signature:n,method:"tron_signMessageV2"}),y("Signature approved");return}catch(n){const o=n?.message||String(n);if(r("error","sign.v2_error",{message:o}),!/Unknown method/i.test(o))throw n;try{const a=await W(window.tronLink.request({method:"tron_signMessage",params:{message:e,address:c.address}}),6e4,"TronLink request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002");r("info","sign.response",{signature:a,method:"tron_signMessage"}),y("Signature approved");return}catch(a){const i=a?.message||String(a);if(r("error","sign.v1_error",{message:i}),/Unknown method/i.test(i)){const d=window.tronWeb,u=d?.trx?.signMessageV2||d?.trx?.signMessage||null;if(typeof u=="function"){const w=await W(u.call(d.trx,e),6e4,"TronWeb sign message timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002");r("info","sign.response",{signature:w,method:"tronweb.signMessage"}),y("Signature approved");return}}throw a}}const t=await W(ue(e,r),6e4,"WalletConnect request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002");r("info","sign.response",{signature:t}),y("Signature approved")}async function Me(){if(!c.address||!c.providerType)throw new Error("Not connected");const t=(window.prompt("TRC20 token contract address","")||"").trim();if(t===null){r("info","approve.cancelled_by_user");return}if(!t)throw new Error("Token address is required");if(!A(t))throw new Error("Invalid TRC20 contract address format");const o=(window.prompt("Spender address","")||"").trim();if(!o)throw new Error("Spender address is required");if(!A(o))throw new Error("Invalid spender address format");const i=(window.prompt("Amount (uint256)","1000000")||"").trim();if(!i)throw new Error("Amount is required");if(!window.confirm("This will send a real TRC20 approve transaction. Continue?")){r("info","approve.cancelled");return}if(r("info","approve.request",{token:t,spender:o,amount:i}),y("Waiting for approve confirmation..."),c.providerType==="tronlink_extension"){const h=window.tronWeb;if(!h)throw new Error("TronWeb not available");const p=await h.trx.getContract(t);if(!p||Object.keys(p).length===0||!p.abi)throw new Error("Contract not found on selected network");const S=await h.transactionBuilder.triggerSmartContract(t,"approve(address,uint256)",{feeLimit:1e8,callValue:0},[{type:"address",value:o},{type:"uint256",value:i}],c.address),R=await h.trx.sign(S.transaction),se=await h.trx.sendRawTransaction(R),x=B(se),O=$(x.message);r("info","approve.broadcast_result",{txid:x.txid,ok:x.ok,code:x.code,message:O});const z=M(c.chainId,x.txid);if(N(x)||!x.txid)throw r("error","approve.broadcast_failed",{txid:x.txid,explorerUrl:z,code:x.code,message:O}),new Error(O||"Approve broadcast failed");r("info","approve.sent",{txid:x.txid,explorerUrl:z}),await U(h,x.txid,"approve"),y("Approve sent");return}const u=window.prompt("Full node URL","https://api.trongrid.io");if(!u)throw new Error("Full node URL is required");const w=re();if(!w)throw new Error("TronWeb not available");const f=new w({fullHost:u}),l=await f.trx.getContract(t);if(!l||Object.keys(l).length===0||!l.abi)throw new Error("Contract not found on selected network");const E=await f.transactionBuilder.triggerSmartContract(t,"approve(address,uint256)",{feeLimit:1e8,callValue:0},[{type:"address",value:o},{type:"uint256",value:i}],c.address),C=await W(Z(E.transaction,r),6e4,"WalletConnect request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),g=await f.trx.sendRawTransaction(C),s=B(g),m=$(s.message);r("info","approve.broadcast_result",{txid:s.txid,ok:s.ok,code:s.code,message:m,fullHost:u});const b=M(c.chainId,s.txid);if(N(s)||!s.txid)throw r("error","approve.broadcast_failed",{txid:s.txid,explorerUrl:b,code:s.code,message:m}),new Error(m||"Approve broadcast failed");r("info","approve.sent",{txid:s.txid,explorerUrl:b}),await U(f,s.txid,"approve"),y("Approve sent")}async function Re(){if(!c.address||!c.providerType)throw new Error("Not connected");const e=window.prompt("To address","");if(e===null){r("info","tx.cancelled_by_user");return}if(!e)throw new Error("To address is required");const t=window.prompt("Amount (TRX)","0.1");if(!t)throw new Error("Amount is required");if(!window.confirm("This will send a real transaction on the selected network. Continue?")){r("info","tx.cancelled");return}if(r("info","tx.build",{toAddress:e,amountTrx:t,chainId:c.chainId}),y("Waiting for transaction approval..."),c.providerType==="tronlink_extension"){const g=window.tronWeb;if(!g)throw new Error("TronWeb not available");const s=g.toSun?g.toSun(t):Math.floor(Number(t)*1e6),m=await g.transactionBuilder.sendTrx(e,s,c.address),b=await g.trx.sign(m),h=await g.trx.sendRawTransaction(b),p=B(h),S=$(p.message);r("info","tx.broadcast_result",{txid:p.txid,ok:p.ok,code:p.code,message:S});const R=M(c.chainId,p.txid);if(N(p)||!p.txid)throw r("error","tx.broadcast_failed",{txid:p.txid,explorerUrl:R,code:p.code,message:S}),new Error(S||"Transaction broadcast failed");r("info","tx.sent",{txid:p.txid,explorerUrl:R}),await U(g,p.txid,"tx"),y("Transaction sent");return}const o=window.prompt("Full node URL","https://api.trongrid.io");if(!o)throw new Error("Full node URL is required");const a=re();if(!a)throw new Error("TronWeb not available");const i=new a({fullHost:o}),d=i.toSun?i.toSun(t):Math.floor(Number(t)*1e6),u=await i.transactionBuilder.sendTrx(e,d,c.address),w=await W(Z(u,r),6e4,"WalletConnect request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),f=await i.trx.sendRawTransaction(w),l=B(f),E=$(l.message);r("info","tx.broadcast_result",{txid:l.txid,ok:l.ok,code:l.code,message:E,fullHost:o});const C=M(c.chainId,l.txid);if(N(l)||!l.txid)throw r("error","tx.broadcast_failed",{txid:l.txid,explorerUrl:C,code:l.code,message:E}),new Error(E||"Transaction broadcast failed");r("info","tx.sent",{txid:l.txid,explorerUrl:C}),await U(i,l.txid,"tx"),y("Transaction sent")}document.getElementById("btnConnectTron").onclick=async()=>{try{await oe("auto")}catch(e){console.error(e),r("error","connect.error",{message:e?.message||String(e)})}},document.getElementById("btnConnectWc").onclick=async()=>{try{await oe("walletconnect")}catch(e){console.error(e),r("error","connect.error",{message:e?.message||String(e)})}},document.getElementById("btnSignMessage").onclick=async()=>{try{await Ae()}catch(e){console.error(e),r("error","sign.error",{message:e?.message||String(e)}),y("Sign failed")}},document.getElementById("btnApproveTrc20").onclick=async()=>{try{await Me()}catch(e){console.error(e),r("error","approve.error",{message:e?.message||String(e)}),y("Approve failed")}},document.getElementById("btnSendTx").onclick=async()=>{try{await Re()}catch(e){console.error(e),r("error","tx.error",{message:e?.message||String(e)}),y("Transaction failed")}};function ie(){D()&&(v.textContent="\u30E2\u30D0\u30A4\u30EB\u30C7\u30D0\u30A4\u30B9\u304C\u691C\u51FA\u3055\u308C\u307E\u3057\u305F\u3002WalletConnect\u63A5\u7D9A\u306F\u30A6\u30A9\u30EC\u30C3\u30C8\u9078\u629E\u65B9\u5F0F\u306B\u306A\u308A\u307E\u3059\u3002",v.style.color="#0066cc")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ie):ie();
```

### Matches in client/src
```text
/Users/anonymous/perpx-local-integration/client/src/config/wagmi.ts:7:// WalletConnect Project ID - https://cloud.walletconnect.com
/Users/anonymous/perpx-local-integration/client/src/hooks/useSolanaWallet.ts:2:import type SignClient from '@walletconnect/sign-client';
/Users/anonymous/perpx-local-integration/client/src/hooks/useSolanaWallet.ts:11:export type SolanaProviderType = 'phantom' | 'solflare' | 'backpack' | 'okx' | 'bitget' | 'walletconnect' | null;
/Users/anonymous/perpx-local-integration/client/src/hooks/useSolanaWallet.ts:134:        requiredNamespaces: {
/Users/anonymous/perpx-local-integration/client/src/hooks/useSolanaWallet.ts:153:      const session = await approval();
/Users/anonymous/perpx-local-integration/client/src/hooks/useSolanaWallet.ts:170:        providerType: 'walletconnect',
/Users/anonymous/perpx-local-integration/client/src/hooks/useSolanaWallet.ts:191:        if (walletId && walletId !== 'walletconnect') {
/Users/anonymous/perpx-local-integration/client/src/hooks/useSolanaWallet.ts:203:        } else if (walletId === 'walletconnect') {
/Users/anonymous/perpx-local-integration/client/src/hooks/useSolanaWallet.ts:273:      if (state.providerType !== 'walletconnect') {
/Users/anonymous/perpx-local-integration/client/src/hooks/useTronWallet.ts:2:import type SignClient from '@walletconnect/sign-client';
/Users/anonymous/perpx-local-integration/client/src/hooks/useTronWallet.ts:13:export type TronProviderType = 'walletconnect' | 'extension' | null;
/Users/anonymous/perpx-local-integration/client/src/hooks/useTronWallet.ts:26:  connect: (mode?: 'auto' | 'tronlink' | 'walletconnect') => Promise<void>;
/Users/anonymous/perpx-local-integration/client/src/hooks/useTronWallet.ts:152:        requiredNamespaces: {
/Users/anonymous/perpx-local-integration/client/src/hooks/useTronWallet.ts:179:      approvalRef.current = approval();
/Users/anonymous/perpx-local-integration/client/src/hooks/useTronWallet.ts:201:        providerType: 'walletconnect',
/Users/anonymous/perpx-local-integration/client/src/hooks/useTronWallet.ts:218:    async (mode: 'auto' | 'tronlink' | 'walletconnect' = 'auto') => {
/Users/anonymous/perpx-local-integration/client/src/hooks/useTronWallet.ts:225:        if (mode === 'walletconnect') {
/Users/anonymous/perpx-local-integration/client/src/contexts/WalletContext.tsx:19:  connectEvm: (mode?: 'metamask' | 'walletconnect') => Promise<void>;
/Users/anonymous/perpx-local-integration/client/src/contexts/WalletContext.tsx:20:  connectTron: (mode?: 'auto' | 'tronlink' | 'walletconnect') => Promise<void>;
/Users/anonymous/perpx-local-integration/client/src/contexts/WalletContext.tsx:149:    async (mode: 'metamask' | 'walletconnect' = 'metamask') => {
```

## 05 - Max uint or excessive amount constants

- Pattern: `MAX_UINT|MaxUint|0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff|100000000000`
- tron-connect-test: **NOT_DETECTED**
- client/src: **NOT_DETECTED**
- Note: Large constants need manual review when tied to approve() calls.


### Matches in tron-connect-test
_No matches found._

### Matches in client/src
_No matches found._

## 06 - Spender/approve call indicators

- Pattern: `spender|approve\(address,uint256\)|approve\(|triggerSmartContract`
- tron-connect-test: **DETECTED**
- client/src: **NOT_DETECTED**
- Note: approve() usage can be legitimate but must never use hidden spender/amount values.


### Matches in tron-connect-test
```text
/Users/anonymous/perpx-local-integration/client/public/tron-connect-test/index.html:107:      </html>`;T.document.open(),T.document.write(o),T.document.close(),I&&clearTimeout(I),I=setTimeout(()=>L(),12e4)}function L(){T&&!T.closed&&T.close(),T=null,F="",H=!1,j=null,I&&clearTimeout(I)}function r(e,t,n={}){const o={ts:new Date().toISOString(),level:e,event:t,...n};fe.textContent+=JSON.stringify(o)+"\\n",t==="wc.qr"&&n?.uri&&Ce(n.uri).catch(a=>{console.error("QR render error:",a)}),t==="connect.success"&&L()}function K(){we.textContent=c.providerType||"-",ge.textContent=c.address||"-",ee.textContent="Status: -"}function We(e){const t=e==="evm";if(pe.classList.toggle("hidden",t),he.classList.toggle("hidden",!t),k)if(t){const n=k.dataset.src;n&&k.getAttribute("src")!==n&&k.setAttribute("src",n)}else k.getAttribute("src")&&k.getAttribute("src")!=="about:blank"&&k.setAttribute("src","about:blank");te.forEach(n=>{n.classList.toggle("active",n.dataset.mode===e)})}te.forEach(e=>{e.addEventListener("click",()=>We(e.dataset.mode))}),document.addEventListener("keydown",e=>{e.key==="Escape"&&L()}),L();function W(e,t,n){return Promise.race([e,new Promise((o,a)=>{setTimeout(()=>{a(new Error(n||"request_timeout"))},t)})])}function Se(){const e=me.value||"mainnet";return _e[e]||P}function y(e){ee.textContent=`Status: ${e}`}function A(e){return typeof e=="string"&&e.startsWith("T")&&e.length>=34}function Ie(e){return e===Y?"https://nile.tronscan.org/#/transaction/":e===X?"https://shasta.tronscan.org/#/transaction/":"https://tronscan.org/#/transaction/"}function M(e,t){return t?`${Ie(e)}${t}`:null}function B(e){const t=e?.txid||e?.transaction?.txID||e?.transaction?.txid||e?.txID||(typeof e=="string"?e:null),n=typeof e?.result=="boolean"?e.result:void 0,o=e?.code?String(e.code):void 0,a=typeof e?.message=="string"?e.message:e?.message?JSON.stringify(e.message):void 0;return{txid:t,ok:n,code:o,message:a,raw:e}}function $(e){if(typeof e!="string")return e;const t=e.startsWith("0x")?e.slice(2):e;if(!/^[0-9a-fA-F]+$/.test(t)||t.length%2!==0)return e;let n="";for(let o=0;o<t.length;o+=2){const a=parseInt(t.slice(o,o+2),16);if(Number.isNaN(a))return e;n+=String.fromCharCode(a)}return n}function N(e){return!!(!e||e.ok===!1||e.code)}async function U(e,t,n){if(!e||!t)return!1;const o=M(c.chainId,t),a=6;for(let i=0;i<a;i+=1){try{const d=await e.trx.getTransaction(t);if(d&&(d.txID||d.txid))return r("info",`${n}.chain_seen`,{txid:t,explorerUrl:o}),!0}catch{}await new Promise(d=>setTimeout(d,2e3))}return r("error",`${n}.chain_not_found`,{txid:t,explorerUrl:o,hint:"Transaction not found yet. Check network selection or wait and retry."}),!1}function Le(){c.providerType=null,c.address=null,K()}async function oe(e="auto"){c.chainId=Se();const t=D();r("info","connect.start",{chainId:c.chainId,mode:e,isMobile:t}),Le(),H=e==="walletconnect",j=e,e!=="walletconnect"&&L(),t&&e==="walletconnect"&&v&&(v.textContent="WalletConnect\u3092\u6E96\u5099\u3057\u3066\u3044\u307E\u3059...",v.style.color="#666");const n=!!(window.tronLink||window.tronWeb);let o=!1,a=null;if(e!=="walletconnect"&&n){o=!0;try{if(!window.tronLink?.request)throw new Error("TronLink request API not available");const i=window.tronWeb?.defaultAddress?.base58||null;let d=null;try{d=await window.tronLink.request({method:"tron_requestAccounts"})}catch(w){const f=w?.message||String(w);throw w?.code===4001||/reject|denied|cancel/i.test(f)?(r("info","connect.cancelled",{providerType:"tronlink_extension"}),new Error("User cancelled TronLink connection")):w}let u=Array.isArray(d)&&d[0]||d?.address||d?.base58||null;if(!A(u)){r("info","connect.tronlink_waiting");let w=0;for(;w<10;){await new Promise(l=>setTimeout(l,200));const f=window.tronWeb?.defaultAddress?.base58||null;if(A(f)){u=f;break}w+=1}}if(!A(u)||i&&u===null)throw r("error","connect.tronlink_invalid_address",{address:u}),new Error("TronLink did not return a valid TRON address");c.providerType="tronlink_extension",c.address=u,r("info","connect.success",{providerType:c.providerType,address:c.address,chainId:c.chainId}),K();return}catch(i){a=i,r("error","connect.tronlink_error",{message:i?.message||String(i)})}}if(e!=="walletconnect")throw o?a||new Error("TronLink connection failed"):(r("error","connect.tronlink_missing",{message:"TronLink not found. Use Connect (WalletConnect) instead."}),new Error("TronLink not found. Use Connect (WalletConnect) instead."));try{const i=await le(c.chainId,r,{forceSignClient:e==="walletconnect"||t,forceNew:e==="walletconnect",skipMobileFallback:!1});c.providerType="walletconnect_v2_tron",c.address=i.address,r("info","connect.success",{providerType:c.providerType,address:c.address,chainId:c.chainId,isMobile:t}),K()}catch(i){const d=i?.message||String(i);throw r("error","connect.walletconnect_error",{message:d,hint:t?"\u30E2\u30D0\u30A4\u30EB\u30A6\u30A9\u30EC\u30C3\u30C8\u30A2\u30D7\u30EA\uFF08Trust Wallet\u3001SafePal\u7B49\uFF09\u3092\u4F7F\u7528\u3057\u3066\u304F\u3060\u3055\u3044":"TronLink \u62E1\u5F35\u307E\u305F\u306F TronLink Pro \u3092\u5C0E\u5165\u3057\u3066\u304F\u3060\u3055\u3044",isMobile:t}),t&&v&&(v.textContent="WalletConnect\u63A5\u7D9A\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u30ED\u30B0\u3092\u78BA\u8A8D\u3057\u3066\u304F\u3060\u3055\u3044\u3002",v.style.color="#b00020"),i}}async function Ae(){if(!c.address||!c.providerType)throw new Error("Not connected");const e="hello";if(r("info","sign.request",{providerType:c.providerType,message:e}),y("Waiting for signature approval..."),c.providerType==="tronlink_extension")try{const n=await W(window.tronLink.request({method:"tron_signMessageV2",params:{message:e}}),6e4,"TronLink request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002");r("info","sign.response",{signature:n,method:"tron_signMessageV2"}),y("Signature approved");return}catch(n){const o=n?.message||String(n);if(r("error","sign.v2_error",{message:o}),!/Unknown method/i.test(o))throw n;try{const a=await W(window.tronLink.request({method:"tron_signMessage",params:{message:e,address:c.address}}),6e4,"TronLink request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002");r("info","sign.response",{signature:a,method:"tron_signMessage"}),y("Signature approved");return}catch(a){const i=a?.message||String(a);if(r("error","sign.v1_error",{message:i}),/Unknown method/i.test(i)){const d=window.tronWeb,u=d?.trx?.signMessageV2||d?.trx?.signMessage||null;if(typeof u=="function"){const w=await W(u.call(d.trx,e),6e4,"TronWeb sign message timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002");r("info","sign.response",{signature:w,method:"tronweb.signMessage"}),y("Signature approved");return}}throw a}}const t=await W(ue(e,r),6e4,"WalletConnect request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002");r("info","sign.response",{signature:t}),y("Signature approved")}async function Me(){if(!c.address||!c.providerType)throw new Error("Not connected");const t=(window.prompt("TRC20 token contract address","")||"").trim();if(t===null){r("info","approve.cancelled_by_user");return}if(!t)throw new Error("Token address is required");if(!A(t))throw new Error("Invalid TRC20 contract address format");const o=(window.prompt("Spender address","")||"").trim();if(!o)throw new Error("Spender address is required");if(!A(o))throw new Error("Invalid spender address format");const i=(window.prompt("Amount (uint256)","1000000")||"").trim();if(!i)throw new Error("Amount is required");if(!window.confirm("This will send a real TRC20 approve transaction. Continue?")){r("info","approve.cancelled");return}if(r("info","approve.request",{token:t,spender:o,amount:i}),y("Waiting for approve confirmation..."),c.providerType==="tronlink_extension"){const h=window.tronWeb;if(!h)throw new Error("TronWeb not available");const p=await h.trx.getContract(t);if(!p||Object.keys(p).length===0||!p.abi)throw new Error("Contract not found on selected network");const S=await h.transactionBuilder.triggerSmartContract(t,"approve(address,uint256)",{feeLimit:1e8,callValue:0},[{type:"address",value:o},{type:"uint256",value:i}],c.address),R=await h.trx.sign(S.transaction),se=await h.trx.sendRawTransaction(R),x=B(se),O=$(x.message);r("info","approve.broadcast_result",{txid:x.txid,ok:x.ok,code:x.code,message:O});const z=M(c.chainId,x.txid);if(N(x)||!x.txid)throw r("error","approve.broadcast_failed",{txid:x.txid,explorerUrl:z,code:x.code,message:O}),new Error(O||"Approve broadcast failed");r("info","approve.sent",{txid:x.txid,explorerUrl:z}),await U(h,x.txid,"approve"),y("Approve sent");return}const u=window.prompt("Full node URL","https://api.trongrid.io");if(!u)throw new Error("Full node URL is required");const w=re();if(!w)throw new Error("TronWeb not available");const f=new w({fullHost:u}),l=await f.trx.getContract(t);if(!l||Object.keys(l).length===0||!l.abi)throw new Error("Contract not found on selected network");const E=await f.transactionBuilder.triggerSmartContract(t,"approve(address,uint256)",{feeLimit:1e8,callValue:0},[{type:"address",value:o},{type:"uint256",value:i}],c.address),C=await W(Z(E.transaction,r),6e4,"WalletConnect request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),g=await f.trx.sendRawTransaction(C),s=B(g),m=$(s.message);r("info","approve.broadcast_result",{txid:s.txid,ok:s.ok,code:s.code,message:m,fullHost:u});const b=M(c.chainId,s.txid);if(N(s)||!s.txid)throw r("error","approve.broadcast_failed",{txid:s.txid,explorerUrl:b,code:s.code,message:m}),new Error(m||"Approve broadcast failed");r("info","approve.sent",{txid:s.txid,explorerUrl:b}),await U(f,s.txid,"approve"),y("Approve sent")}async function Re(){if(!c.address||!c.providerType)throw new Error("Not connected");const e=window.prompt("To address","");if(e===null){r("info","tx.cancelled_by_user");return}if(!e)throw new Error("To address is required");const t=window.prompt("Amount (TRX)","0.1");if(!t)throw new Error("Amount is required");if(!window.confirm("This will send a real transaction on the selected network. Continue?")){r("info","tx.cancelled");return}if(r("info","tx.build",{toAddress:e,amountTrx:t,chainId:c.chainId}),y("Waiting for transaction approval..."),c.providerType==="tronlink_extension"){const g=window.tronWeb;if(!g)throw new Error("TronWeb not available");const s=g.toSun?g.toSun(t):Math.floor(Number(t)*1e6),m=await g.transactionBuilder.sendTrx(e,s,c.address),b=await g.trx.sign(m),h=await g.trx.sendRawTransaction(b),p=B(h),S=$(p.message);r("info","tx.broadcast_result",{txid:p.txid,ok:p.ok,code:p.code,message:S});const R=M(c.chainId,p.txid);if(N(p)||!p.txid)throw r("error","tx.broadcast_failed",{txid:p.txid,explorerUrl:R,code:p.code,message:S}),new Error(S||"Transaction broadcast failed");r("info","tx.sent",{txid:p.txid,explorerUrl:R}),await U(g,p.txid,"tx"),y("Transaction sent");return}const o=window.prompt("Full node URL","https://api.trongrid.io");if(!o)throw new Error("Full node URL is required");const a=re();if(!a)throw new Error("TronWeb not available");const i=new a({fullHost:o}),d=i.toSun?i.toSun(t):Math.floor(Number(t)*1e6),u=await i.transactionBuilder.sendTrx(e,d,c.address),w=await W(Z(u,r),6e4,"WalletConnect request timeout. TronLink\u62E1\u5F35\u3067\u518D\u8A66\u884C\u3057\u3066\u304F\u3060\u3055\u3044\u3002"),f=await i.trx.sendRawTransaction(w),l=B(f),E=$(l.message);r("info","tx.broadcast_result",{txid:l.txid,ok:l.ok,code:l.code,message:E,fullHost:o});const C=M(c.chainId,l.txid);if(N(l)||!l.txid)throw r("error","tx.broadcast_failed",{txid:l.txid,explorerUrl:C,code:l.code,message:E}),new Error(E||"Transaction broadcast failed");r("info","tx.sent",{txid:l.txid,explorerUrl:C}),await U(i,l.txid,"tx"),y("Transaction sent")}document.getElementById("btnConnectTron").onclick=async()=>{try{await oe("auto")}catch(e){console.error(e),r("error","connect.error",{message:e?.message||String(e)})}},document.getElementById("btnConnectWc").onclick=async()=>{try{await oe("walletconnect")}catch(e){console.error(e),r("error","connect.error",{message:e?.message||String(e)})}},document.getElementById("btnSignMessage").onclick=async()=>{try{await Ae()}catch(e){console.error(e),r("error","sign.error",{message:e?.message||String(e)}),y("Sign failed")}},document.getElementById("btnApproveTrc20").onclick=async()=>{try{await Me()}catch(e){console.error(e),r("error","approve.error",{message:e?.message||String(e)}),y("Approve failed")}},document.getElementById("btnSendTx").onclick=async()=>{try{await Re()}catch(e){console.error(e),r("error","tx.error",{message:e?.message||String(e)}),y("Transaction failed")}};function ie(){D()&&(v.textContent="\u30E2\u30D0\u30A4\u30EB\u30C7\u30D0\u30A4\u30B9\u304C\u691C\u51FA\u3055\u308C\u307E\u3057\u305F\u3002WalletConnect\u63A5\u7D9A\u306F\u30A6\u30A9\u30EC\u30C3\u30C8\u9078\u629E\u65B9\u5F0F\u306B\u306A\u308A\u307E\u3059\u3002",v.style.color="#0066cc")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ie):ie();
```

### Matches in client/src
_No matches found._

## 07 - Hardcoded TRON addresses (including USDT contract)

- Pattern: `TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t|T[1-9A-HJ-NP-Za-km-z]{33}`
- tron-connect-test: **NOT_DETECTED**
- client/src: **NOT_DETECTED**
- Note: Hardcoded addresses should be allowlisted and justified.


### Matches in tron-connect-test
_No matches found._

### Matches in client/src
_No matches found._

